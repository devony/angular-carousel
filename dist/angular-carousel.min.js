/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.8 - 2013-06-07
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-carousel",["ngMobile"]).filter("carouselSlice",function(){return function(e,a,t){return e.slice(a,t)}}).directive("rnCarousel",["$compile","$parse","$swipe",function(e,a,t){var n=0;return{restrict:"A",scope:!0,compile:function(r,s){r.addClass("rn-carousel-slides");var i=r.find("li")[0].attributes["ng-repeat"],o=i.value.match(/^([^\s]+) in (.+)$/i),u=o[1],l=o[2],c=angular.isDefined(s.rnCarouselBuffered);if(c){var d="|carouselSlice:carouselBufferStart:carouselBufferStart+carouselBufferSize";i.value=u+" in carouselItems"+d}return function(r,s,i){function o(){b.addClass("rn-carousel-noanimate").css({left:r.carouselBufferStart*$+"px"})}function u(){return r.totalIndex>0&&0===r.activeIndex}function d(){var e=r.activeIndex===b.find("li").length-1;return e}function f(){x()}function x(){if(c){var e=!1;if(d()&&(r.$apply(function(){r.carouselBufferStart+=1,o()}),e=N()-1>r.totalIndex+1,!e&&angular.isDefined(i.rnCarouselNext))){var t=a(i.rnCarouselNext)(r,{index:r.totalIndex+1,item:r.carouselItems[r.carouselItems.length-1]});z.add("append",t)}if(u()&&(r.$apply(function(){r.carouselBufferStart-=1,o()}),e=r.carouselBufferStart>0,!e&&angular.isDefined(i.rnCarouselPrev))){var n=a(i.rnCarouselPrev)(r,{index:0,item:r.carouselItems[0]});z.add("prepend",n)}}}function I(e,a){var t={};return t[e]=a,angular.forEach(A,function(n){t["-"+n.toLowerCase()+"-"+e]=a}),t}function m(e){return I("transform","translate3d("+e+"px,0,0)")}function v(){r.activeIndex=r.totalIndex-r.carouselBufferStart}n++;var p="rn-carousel-"+n,h=0,g=0,B=0,C=0,S=.1,$=0,w=!0,M=!1,b=s.wrap("<div id='"+p+"' class='rn-carousel-container'></div>"),y=b.parent();r.carouselItems=[],r.carouselBufferStart=0,r.totalIndex=0,r.activeIndex=0;var z={add:function(e,a){a&&(angular.isObject(a.promise)?a.promise.then(function(a){z[e](a)}):z[e](a))},append:function(e){angular.isArray(e)?r.carouselItems=r.carouselItems.concat(e):r.carouselItems.push(e)},prepend:function(e){w=!0;var a=1;angular.isArray(e)?(a=e.length,r.carouselItems=e.concat(r.carouselItems)):r.carouselItems.splice(0,0,e),r.carouselBufferStart-=a,r.totalIndex+=a,v(),r.$$phase||L()}},A=["webkit","moz"];if(c&&(r.carouselBufferSize=3,b[0].addEventListener("webkitTransitionEnd",f,!1),b[0].addEventListener("transitionend",f,!1),r.$watch("carouselBufferStart",function(){v()})),i.rnCarouselIndex){var D=a(i.rnCarouselIndex);angular.isFunction(D.assign)?(r.$watch("totalIndex",function(e){D.assign(r.$parent,e)}),r.$parent.$watch(D,function(e){r.totalIndex=Math.max(0,e)})):isNaN(i.rnCarouselIndex)||(r.totalIndex=Math.max(0,parseInt(i.rnCarouselIndex,10)))}if(r.$watch("totalIndex",function(e,a){e!==a&&L(),v()}),r.$watch(l,function(e,a){e!==a&&(r.totalIndex=0,c&&(r.carouselBufferStart=0,o()))}),r.$watch(l,function(e){if(r.carouselItems=e,0===$){var a=b.find("li");$=0===a.length?b[0].getBoundingClientRect().width:a[0].getBoundingClientRect().width,y.css("width",$+"px"),L()}},!0),angular.isDefined(i.rnCarouselIndicator)){var E=e("<div id='"+p+"-indicator' index='totalIndex' items='carouselItems' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(r);y.append(E)}var N=function(){return r.carouselItems.length},L=function(){var e=w===!0,a=N();if(r.totalIndex>a-1&&(r.totalIndex=a-1),0>r.totalIndex&&(r.totalIndex=0),c){(r.totalIndex<r.carouselBufferStart||r.totalIndex>r.carouselBufferStart+r.carouselBufferSize-1)&&(r.carouselBufferStart=Math.max(0,r.totalIndex-1),e=!0,o());var t=Math.max(0,Math.min(r.carouselBufferStart,a-r.carouselBufferSize));r.carouselBufferStart=t}C=r.totalIndex*-$,e===!0?b.addClass("rn-carousel-noanimate").css(m(C)):b.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(m(C)),w=!1};t.bind(b,{start:function(e){0===h&&(h=1,g=e.x)},move:function(e){if(0!==h){var a=e.x-g;if(1===h&&0!==a)h=2,B=C;else if(2===h){var t=N(),n=1;(0===r.totalIndex&&e.x>g||r.totalIndex===t-1&&g>e.x)&&(n=3),C=B+a/n,b.css(m(C)).removeClass().addClass("rn-carousel-noanimate")}}},end:function(e){if(h>0){M=!1,h=0;var a=N(),t=B>C?1:-1,n=Math.min(Math.max(0,r.totalIndex+t),a-1),s=e.x-g;$*S>=Math.abs(s)&&(n=r.totalIndex);var i=r.totalIndex!==n;i?r.$apply(function(){r.totalIndex=n}):(M=!0,L())}}})}}}}]).directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]);
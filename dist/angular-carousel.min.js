/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.8 - 2013-06-08
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-carousel",["ngMobile"]).filter("carouselSlice",function(){return function(e,a,n){return e.slice(a,n)}}).directive("rnCarousel",["$compile","$parse","$swipe",function(e,a,n){var t=0;return{restrict:"A",scope:!0,compile:function(r,i){r.addClass("rn-carousel-slides");var s=r.find("li")[0].attributes["ng-repeat"],u=s.value.match(/^([^\s]+) in (.+)$/i),o=u[1],l=u[2],c=angular.isDefined(i.rnCarouselBuffered);if(c){var f="|carouselSlice:carouselBufferStart:carouselBufferStart+carouselBufferSize";s.value=o+" in carouselItems"+f}return function(r,i,s){function u(){N.addClass("rn-carousel-noanimate").css({left:r.carouselBufferStart*A+"px"})}function o(){return r.totalIndex>0&&0===r.activeIndex}function f(){var e=r.activeIndex===N.find("li").length-1;return e}function d(){E||r.$apply(function(){I()})}function x(e,a){if(c){var n=R()-r.carouselBufferSize,t=r.carouselBufferStart;r.carouselBufferStart=Math.max(0,Math.min(e,n)),a&&r.carouselBufferStart!==t&&u()}}function v(e){null===e&&(e=r.totalIndex);var a=null===A?Number.MAX_VALUE:R()-1;r.totalIndex=Math.max(0,Math.min(a,e))}function I(){if(c){var e=!1;if(f()&&(x(r.carouselBufferStart+1,!0),e=R()-1>r.totalIndex+1,!e&&angular.isDefined(s.rnCarouselNext))){var n=a(s.rnCarouselNext)(r,{index:r.totalIndex+1,item:r.carouselItems[r.carouselItems.length-1]});D.add("append",n)}if(o()&&(x(r.carouselBufferStart-1,!0),e=r.carouselBufferStart>0,!e&&angular.isDefined(s.rnCarouselPrev))){var t=a(s.rnCarouselPrev)(r,{index:0,item:r.carouselItems[0]});D.add("prepend",t)}}}function m(e,a){var n={};return n[e]=a,angular.forEach(L,function(t){n["-"+t.toLowerCase()+"-"+e]=a}),n}function p(e){return m("transform","translate3d("+e+"px,0,0)")}function g(){r.activeIndex=r.totalIndex-r.carouselBufferStart}function h(){var e=!1;return R(),c&&(r.totalIndex<r.carouselBufferStart&&(e=!0,x(0,!0)),r.totalIndex>r.carouselBufferStart+r.carouselBufferSize-1&&(e=!0,x(r.totalIndex-1,!0))),e}function B(){v(null);var e=h()||z===!0;M=r.totalIndex*-A,e===!0?N.addClass("rn-carousel-noanimate").css(p(M)):N.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(p(M)),z=!1}t++;var C="rn-carousel-"+t,S=0,$=0,w=0,M=0,b=.1,A=null,z=!0,E=!1,N=i.wrap("<div id='"+C+"' class='rn-carousel-container'></div>"),y=N.parent();r.carouselItems=[],r.carouselBufferStart=0,r.totalIndex=0,r.activeIndex=0;var D={add:function(e,a){a&&(angular.isObject(a.promise)?a.promise.then(function(a){D[e](a)}):D[e](a))},append:function(e){angular.isArray(e)?r.carouselItems=r.carouselItems.concat(e):r.carouselItems.push(e)},prepend:function(e){z=!0;var a=1;angular.isArray(e)?(a=e.length,r.carouselItems=e.concat(r.carouselItems)):r.carouselItems.splice(0,0,e),r.carouselBufferStart-=a,v(r.totalIndex+a),r.$$phase||B()}},L=["webkit","moz"];if(c&&(r.carouselBufferSize=3,N[0].addEventListener("webkitTransitionEnd",d,!1),N[0].addEventListener("transitionend",d,!1),r.$watch("carouselBufferStart",function(){g()})),s.rnCarouselIndex){var k=a(s.rnCarouselIndex);angular.isFunction(k.assign)?(r.$watch("totalIndex",function(e){k.assign(r.$parent,e)}),r.$parent.$watch(k,function(e){v(e)})):isNaN(s.rnCarouselIndex)||v(parseInt(s.rnCarouselIndex,10))}if(r.$watch(l,function(e,a){e!==a&&(v(0),c&&x(0,!0))}),r.$watch(l,function(e){if(r.carouselItems=e,null===A){var a=N.find("li");A=0===a.length?N[0].getBoundingClientRect().width:a[0].getBoundingClientRect().width,y.css("width",A+"px"),B()}},!0),r.$watch("totalIndex",function(){B(),g()}),angular.isDefined(s.rnCarouselIndicator)){var P=e("<div id='"+C+"-indicator' index='totalIndex' items='carouselItems' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(r);y.append(P)}var R=function(){return r.carouselItems.length};n.bind(N,{start:function(e){0===S&&(S=1,$=e.x)},move:function(e){if(0!==S){var a=e.x-$;if(1===S&&0!==a)S=2,w=M;else if(2===S){var n=R(),t=1;(0===r.totalIndex&&e.x>$||r.totalIndex===n-1&&$>e.x)&&(t=3),M=w+a/t,N.css(p(M)).removeClass().addClass("rn-carousel-noanimate")}}},end:function(e){if(S>0){E=!1,S=0;var a=R(),n=w>M?1:-1,t=Math.min(Math.max(0,r.totalIndex+n),a-1),i=e.x-$;A*b>=Math.abs(i)&&(t=r.totalIndex);var s=r.totalIndex!==t;s?r.$apply(function(){v(t)}):(E=!0,B())}}})}}}}]).directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]);
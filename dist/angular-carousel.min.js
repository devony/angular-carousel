/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.8 - 2013-06-07
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-carousel",["ngMobile"]).filter("carouselSlice",function(){return function(e,a,t){return e.slice(a,t)}}).directive("rnCarousel",["$compile","$parse","$swipe",function(e,a,t){var r=0;return{restrict:"A",scope:!0,compile:function(n,s){n.addClass("rn-carousel-slides");var o=n.find("li")[0].attributes["ng-repeat"],i=o.value.match(/^([^\s]+) in (.+)$/i),l=i[1],u=i[2],c=angular.isDefined(s.rnCarouselBuffered);if(c){var d="|carouselSlice:carouselBufferStart:carouselBufferStart+carouselBufferSize";o.value=l+" in carouselItems"+d}return function(n,s,o){function i(){M.addClass("rn-carousel-noanimate").css({left:n.carouselBufferStart*S+"px"})}function l(){return n.totalIndex>0&&0===n.activeIndex}function d(){var e=n.totalIndex===D()-1,a=n.activeIndex===M.find("li").length-1;return a&&!e}function f(){var e=!1;if(d()&&(n.$apply(function(){n.carouselBufferStart+=1,i()}),e=D()-1>n.totalIndex+1,!e&&angular.isDefined(o.rnCarouselNext))){var t=a(o.rnCarouselNext)(n,{index:n.totalIndex+1,item:n.carouselItems[n.carouselItems.length-1]});t&&(angular.isArray(t)?n.carouselItems=n.carouselItems.concat(t):n.carouselItems.push(t))}if(l()&&(n.$apply(function(){n.carouselBufferStart-=1,i()}),e=n.carouselBufferStart>0,!e&&angular.isDefined(o.rnCarouselPrev))){var r=a(o.rnCarouselPrev)(n,{index:0,item:n.carouselItems[0]});r&&n.$apply(function(){$=!0;var e=1;angular.isArray(r)?(e=r.length,n.carouselItems=r.concat(n.carouselItems)):n.carouselItems.splice(0,0,r),n.carouselBufferStart-=e,n.totalIndex+=e,v()})}}function x(e,a){var t={};return t[e]=a,angular.forEach(y,function(r){t["-"+r.toLowerCase()+"-"+e]=a}),t}function I(e){return x("transform","translate3d("+e+"px,0,0)")}function v(){n.activeIndex=n.totalIndex-n.carouselBufferStart}r++;var m="rn-carousel-"+r,p=0,g=0,h=0,B=0,C=.1,S=0,$=!0,w=!1,M=s.wrap("<div id='"+m+"' class='rn-carousel-container'></div>"),b=M.parent();n.carouselItems=[],n.carouselBufferStart=0,n.totalIndex=0,n.activeIndex=0;var y=["webkit","moz"];if(c&&(n.carouselBufferSize=3,M[0].addEventListener("webkitTransitionEnd",f,!1),M[0].addEventListener("transitionend",f,!1),n.$watch("carouselBufferStart",function(){v()})),o.rnCarouselIndex){var z=a(o.rnCarouselIndex);angular.isFunction(z.assign)?(n.$watch("totalIndex",function(e){z.assign(n.$parent,e)}),n.$parent.$watch(z,function(e){n.totalIndex=Math.max(0,e)})):isNaN(o.rnCarouselIndex)||(n.totalIndex=Math.max(0,parseInt(o.rnCarouselIndex,10)))}if(n.$watch("totalIndex",function(e,a){e!==a&&E(),v()}),n.$watch(u,function(e,a){e!==a&&(n.totalIndex=0,c&&(n.carouselBufferStart=0,i()))}),n.$watch(u,function(e){n.carouselItems=e;var a=M.find("li");0===S&&(S=0===a.length?M[0].getBoundingClientRect().width:a[0].getBoundingClientRect().width,b.css("width",S+"px"),E())},!0),angular.isDefined(o.rnCarouselIndicator)){var A=e("<div id='"+m+"-indicator' index='totalIndex' items='carouselItems' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(n);b.append(A)}var D=function(){return n.carouselItems.length},E=function(){var e=$===!0,a=D();if(n.totalIndex>a-1&&(n.totalIndex=a-1),0>n.totalIndex&&(n.totalIndex=0),c){(n.totalIndex<n.carouselBufferStart||n.totalIndex>n.carouselBufferStart+n.carouselBufferSize-1)&&(n.carouselBufferStart=Math.max(0,n.totalIndex-1),e=!0,i());var t=Math.max(0,Math.min(n.carouselBufferStart,a-n.carouselBufferSize));n.carouselBufferStart=t}B=n.totalIndex*-S,e===!0?M.addClass("rn-carousel-noanimate").css(I(B)):M.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(I(B)),$=!1};t.bind(M,{start:function(e){0===p&&(p=1,g=e.x)},move:function(e){if(0!==p){var a=e.x-g;if(1===p&&0!==a)p=2,h=B;else if(2===p){var t=D(),r=1;(0===n.totalIndex&&e.x>g||n.totalIndex===t-1&&g>e.x)&&(r=3),B=h+a/r,M.css(I(B)).removeClass().addClass("rn-carousel-noanimate")}}},end:function(e){if(p>0){w=!1,p=0;var a=D(),t=h>B?1:-1,r=Math.min(Math.max(0,n.totalIndex+t),a-1),s=e.x-g;S*C>=Math.abs(s)&&(r=n.totalIndex);var o=n.totalIndex!==r;o?n.$apply(function(){n.totalIndex=r}):(w=!0,E())}}})}}}}]).directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]);
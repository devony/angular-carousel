/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.8 - 2013-06-11
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-carousel",["ngMobile"]).filter("carouselSlice",function(){return function(e,n,a){return e.slice(n,a)}}).directive("rnCarousel",["$compile","$parse","$swipe","$timeout",function(e,n,a){var t=0;return{restrict:"A",scope:!0,compile:function(r,i){r.addClass("rn-carousel-slides");var o=r.find("li")[0].attributes["ng-repeat"],s=o.value.match(/^([^\s]+) in (.+)$/i),u=s[1],l=s[2],c=angular.isDefined(i.rnCarouselBuffered);if(c){var d="|carouselSlice:carouselBufferStart:carouselBufferStart+carouselBufferSize";o.value=u+" in carouselItems"+d}return function(r,i,o){function s(){return 1>=r.totalIndex}function u(){return r.totalIndex>=P()-2}function d(){console.log("transitionEndCallback"),c&&r.$apply(function(){f(),x()})}function f(){if(c){var e=r.totalIndex-1,n=P()>0?P()-r.carouselBufferSize:Number.MAX_VALUE;r.carouselBufferStart,r.carouselBufferStart=Math.max(0,Math.min(e,n))}}function m(e){null===e&&(e=r.totalIndex);var n=null===M?Number.MAX_VALUE:P()-1;r.totalIndex=Math.max(0,Math.min(n,e))}function x(){if(c){var e=!1;if(u()&&(e=P()-1>r.totalIndex+1,!e&&angular.isDefined(o.rnCarouselNext))){var a=n(o.rnCarouselNext)(r,{index:r.totalIndex+1,item:r.carouselItems[r.carouselItems.length-1]});z.add("append",a)}if(s()&&(e=r.carouselBufferStart>0,!e&&angular.isDefined(o.rnCarouselPrev))){var t=n(o.rnCarouselPrev)(r,{index:0,item:r.carouselItems[0]});z.add("prepend",t)}}}function I(e,n){var a={};return a[e]=n,angular.forEach(L,function(t){a["-"+t.toLowerCase()+"-"+e]=n}),a}function p(e){return I("transform","translate3d("+e+"px,0,0)")}function v(){r.activeIndex=r.totalIndex-r.carouselBufferStart}function g(){var e=!1;return P(),c&&(r.totalIndex<r.carouselBufferStart?e=!0:r.totalIndex>r.carouselBufferStart+r.carouselBufferSize-1&&(e=!0),e&&f()),e}function h(e){m(null),e=g()||A===!0||e,w=(r.totalIndex-r.carouselBufferStart)*-M,e===!0?N.addClass("rn-carousel-noanimate").css(p(w)):N.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(p(w)),A=!1}t++;var C="rn-carousel-"+t,$=0,B=0,S=0,w=0,b=.1,M=null,A=!0,E=!1,N=i.wrap("<div id='"+C+"' class='rn-carousel-container'></div>"),y=N.parent();r.carouselItems=[],r.carouselBufferStart=0,r.totalIndex=0,r.activeIndex=0;var z={add:function(e,n){n&&(angular.isObject(n.promise)?n.promise.then(function(n){z[e](n)}):z[e](n))},append:function(e){angular.isArray(e)?r.carouselItems=r.carouselItems.concat(e):r.carouselItems.push(e),f()},prepend:function(e){A=!0;var n=1;angular.isArray(e)?(n=e.length,r.carouselItems=e.concat(r.carouselItems)):r.carouselItems.splice(0,0,e),m(r.totalIndex+n),r.$$phase||h()}},L=["webkit","moz"];if(c&&(r.carouselBufferSize=3,N[0].addEventListener("webkitTransitionEnd",d,!1),N[0].addEventListener("transitionend",d,!1),r.$watch("carouselBufferStart",function(){v(),h(!0)})),o.rnCarouselIndex){var D=n(o.rnCarouselIndex);angular.isFunction(D.assign)?(r.$watch("totalIndex",function(e){D.assign(r.$parent,e)}),r.$parent.$watch(D,function(e){m(e)})):isNaN(o.rnCarouselIndex)||m(parseInt(o.rnCarouselIndex,10))}if(r.$watch(l,function(e,n){e!==n&&(m(0),r.carouselBufferStart=0)}),r.$watch(l,function(e){if(r.carouselItems=e,null===M){var n=N.find("li");M=0===n.length?N[0].getBoundingClientRect().width:n[0].getBoundingClientRect().width,y.css("width",M+"px")}},!0),r.$watch("totalIndex",function(){h(!E),v(),!E&&c&&x(),E=!0}),angular.isDefined(o.rnCarouselIndicator)){var k=e("<div id='"+C+"-indicator' index='totalIndex' items='carouselItems' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(r);y.append(k)}var P=function(){return r.carouselItems.length};a.bind(N,{start:function(e){0===$&&($=1,B=e.x)},move:function(e){if(0!==$){var n=e.x-B;if(1===$&&0!==n)$=2,S=w;else if(2===$){var a=P(),t=1;(0===r.totalIndex&&e.x>B||r.totalIndex===a-1&&B>e.x)&&(t=3),w=S+n/t,N.css(p(w)).removeClass().addClass("rn-carousel-noanimate")}}},end:function(e){if($>0){$=0;var n=P(),a=S>w?1:-1,t=Math.min(Math.max(0,r.totalIndex+a),n-1),i=e.x-B;M*b>=Math.abs(i)&&(t=r.totalIndex);var o=r.totalIndex!==t;o?r.$apply(function(){m(t)}):r.$apply(function(){h()})}}})}}}}]).directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]);